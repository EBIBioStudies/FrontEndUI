<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE urlrewrite
        PUBLIC "-//tuckey.org//DTD UrlRewrite 4.0//EN"
        "http://www.tuckey.org/res/dtds/urlrewrite4.0.dtd">

<urlrewrite>
    <!-- special treatment for googlebots -->
    <rule>
        <from>^/browse\.html$</from>
        <condition type="parameter" name="keywords" operator="equal">E-\w{4}-\d+</condition>
        <condition type="parameter" name="detailedview" operator="equal">on</condition>
        <condition name="user-agent">.*Googlebot.*</condition>
        <to type="permanent-redirect">%{context-path}/experiments/%{parameter:keywords}</to>
    </rule>

    <rule>
        <from>^/browse\.html$</from>
        <condition name="user-agent">.*Googlebot.*</condition>
        <to type="forward">/servlets/query/experiments/browse-experiments-noajax/html</to>
    </rule>

    <rule>
        <from>^/migration.html$</from>
        <to type="permanent-redirect">%{context-path}/admin.html</to>
    </rule>

    <rule>
        <from>^/admin.html$</from>
        <to type="forward">/servlets/query/-/admin/html</to>
    </rule>

    <!-- accession shortcuts -->
    <rule>
        <from>^/(E-\w{4}-\d+)$</from>
        <to type="redirect">%{context-path}/experiments/$1</to>
    </rule>
    <rule>
        <from>^/(A-\w{4}-\d+)$</from>
        <to type="redirect">%{context-path}/arrays/$1</to>
    </rule>

    <!-- experiments -->
    <rule>
        <from>^/experiments/?$</from>
        <to type="redirect">%{context-path}/browse.html</to>
    </rule>
    <rule>
        <from>^/experiments/browse\.html$</from>
        <to type="forward">/servlets/query/experiments/experiments/html</to>
    </rule>
    <rule>
        <from>^/experiments/(E-\w{4}-\d+)$</from>
        <set type="parameter" name="accession">$1</set>
        <to type="forward">/servlets/query/experiments/experiments/html</to>
    </rule>
    <rule>
        <from>^/experiments/(E-\w{4}-\d+)/.*sdrf\.html$</from>
        <to type="redirect">%{context-path}/experiments/${upper:$1}/samples.html</to>
    </rule>
    <rule>
        <from>^/experiments/(E-\w{4}-\d+)/samples\.html$</from>
        <set type="parameter" name="accession">$1</set>
        <to type="forward">/servlets/query/experiments/samples-view/html</to>
    </rule>
    <rule>
        <from>^/experiments/(E-\w{4}-\d+)/([^\.]+)\.samples.xml$</from>
        <to type="forward">/servlets/fftransform/$1/$1.$2.$3.txt/default/xml</to>
    </rule>
    <rule>
        <from>^/experiments/(E-\w{4}-\d+)/samples-test\.html$</from>
        <set type="parameter" name="accession">$1</set>
        <to type="forward">/servlets/query/experiments/samples-view-test/html</to>
    </rule>

    <!-- add to genomespace wizard -->
    <rule>
        <from>^/experiments/(E-\w{4}-\d+)/genomespace\.html$</from>
        <set type="parameter" name="accession">$1</set>
        <to type="forward">/servlets/query/-/add-to-genomespace/html</to>
    </rule>

    <!-- legacy idf viewer -->
    <rule>
        <from>^/experiments/(E-\w{4}-\d+)/idf\.html$</from>
        <to type="forward">/servlets/fftransform/$1/$1.$2.txt/idf-view/html</to>
    </rule>

    <rule>
        <from>^/test/(.+)\.html$</from>
        <to type="redirect">/test/${upper:$1}/${upper:$1}.html</to>
    </rule>

    <!-- arrays -->
    <rule>
        <from>^/arrays/?$</from>
        <condition type="query-string" operator="greater"/>
        <to type="redirect">%{context-path}/arrays/browse.html?%{query-string}</to>
    </rule>
    <rule>
        <from>^/arrays/?$</from>
        <to type="redirect">%{context-path}/arrays/browse.html</to>
    </rule>
    <rule>
        <from>^/arrays/browse\.html$</from>
        <to type="forward">/servlets/query/arrays/arrays/html</to>
    </rule>
    <rule>
        <from>^/arrays/(A-\w{4}-\d+)/?$</from>
        <set type="parameter" name="accession">$1</set>
        <to type="forward">/servlets/query/arrays/arrays/html</to>
    </rule>

    <!-- protocols -->
    <rule>
        <from>^/protocols/?$</from>
        <condition type="query-string" operator="greater"/>
        <to type="redirect">%{context-path}/protocols/browse.html?%{query-string}</to>
    </rule>
    <rule>
        <from>^/protocols/?$</from>
        <to type="redirect">%{context-path}/protocols/browse.html</to>
    </rule>
    <rule>
        <from>^/protocols/browse\.html$</from>
        <to type="forward">/servlets/query/protocols/protocols/html</to>
    </rule>
    <rule>
        <from>^/protocols/(\d+)/?$</from>
        <set type="parameter" name="id">$1</set>
        <to type="forward">/servlets/query/protocols/protocols/html</to>
    </rule>
    <rule>
        <from>^/protocols/(.+)/?$</from>
        <set type="parameter" name="accession">$1</set>
        <to type="forward">/servlets/query/protocols/protocols/html</to>
    </rule>

    <!-- files -->
    <rule>
        <from>^/files/?$</from>
        <to type="redirect">%{context-path}/files/browse.html</to>
    </rule>
    <rule>
        <from>^/files/browse\.html$</from>
        <to type="forward">/servlets/query/files/files/html</to>
    </rule>
    <rule>
        <from>^/files/([AE]-\w{4}-\d+)/?$</from>
        <set type="parameter" name="accession">$1</set>
        <to type="forward">/servlets/query/-/files/html</to>
    </rule>
    <rule>
        <from>^/files/([AE]-\w{4}-\d+)/index.html$</from>
        <set type="parameter" name="accession">$1</set>
        <to type="forward">/servlets/query/-/files/html</to>
    </rule>
    <rule>
        <from>^/files/([AE]-\w{4}-\d+)/([^/]+\.zip)/([^/]+)$</from>
        <to type="forward">/servlets/archdownload/${upper:$1}/$2/$3</to>
    </rule>
    <rule>
        <from>^/files/([AE]-\w{4}-\d+)/(.+)$</from>
        <to type="forward">/servlets/download/${upper:$1}/$2</to>
    </rule>

    <!-- users -->
    <rule>
        <from>^/users/?$</from>
        <to type="redirect">%{context-path}/users/browse.html</to>
    </rule>
    <rule>
        <from>^/users/browse\.html$</from>
        <to type="forward">/servlets/query/users/users/html</to>
    </rule>
    <rule>
        <from>^/users/(.+)$</from>
        <set type="parameter" name="id">$1</set>
        <to type="forward">/servlets/query/users/users/html</to>
    </rule>

    <!-- legacy download support -->
    <rule>
        <from>^/download/(.+)$</from>
        <to type="forward">/servlets/download/$1</to>
    </rule>

    <!-- rss feeds support, old scheme -->
    <rule>
        <from>^/rss/experiments$</from>
        <set type="parameter" name="queryversion">1</set>
        <to type="forward">/servlets/query/experiments/experiments-rss/xml</to>
    </rule>

    <!-- rss feeds support, current scheme -->
    <rule>
        <from>^/rss/v2/experiments$</from>
        <to type="forward">/servlets/query/experiments/experiments-rss/xml</to>
    </rule>

    <!-- rest api support -->
    <rule>
        <from>^/xml/experiments$</from>
        <set type="parameter" name="queryversion">1</set>
        <to type="forward">/servlets/query/experiments/experiments/xml</to>
    </rule>
    <rule>
        <from>^/xml/experiments/([E]-\w{4}-\d+)$</from>
        <set type="parameter" name="accession">$1</set>
        <to type="forward">/servlets/query/experiments/experiments/xml</to>
    </rule>
        <rule>
        <from>^/xml/experiments/diff/([E]-\w{4}-\d+)/(.+)$</from>
            <set type="parameter" name="accession">$1</set>
            <set type="parameter" name="source">$2</set>
            <to type="forward">/servlets/query/experiments/diff-experiment/xml</to>
    </rule>
    <rule>
        <from>^/xml/experiments/(.*)$</from>
        <set type="parameter" name="queryversion">1</set>
        <set type="parameter" name="keywords">$1</set>
        <to type="forward">/servlets/query/experiments/experiments/xml</to>
    </rule>
    <rule>
        <from>^/xml/files$</from>
        <set type="parameter" name="queryversion">1</set>
        <to type="forward">/servlets/query/experiments/files/xml</to>
    </rule>
    <rule>
        <from>^/xml/files/([AE]-\w{4}-\d+)$</from>
        <set type="parameter" name="accession">$1</set>
        <to type="forward">/servlets/query/experiments/files/xml</to>
    </rule>
    <rule>
        <from>^/xml/files/(.*)$</from>
        <set type="parameter" name="queryversion">1</set>
        <set type="parameter" name="keywords">$1</set>
        <to type="forward">/servlets/query/experiments/files/xml</to>
    </rule>

    <!-- rest api v2 support -->
    <rule>
        <from>^/xml/v2/experiments$</from>
        <to type="forward">/servlets/query/experiments/experiments/xml</to>
    </rule>
    <rule>
        <from>^/xml/v2/experiments/([E]-\w{4}-\d+)$</from>
        <set type="parameter" name="accession">$1</set>
        <to type="forward">/servlets/query/experiments/experiments/xml</to>
    </rule>
    <rule>
        <from>^/xml/v2/experiments/(.*)$</from>
        <set type="parameter" name="keywords">$1</set>
        <to type="forward">/servlets/query/experiments/experiments/xml</to>
    </rule>
    <rule>
        <from>^/xml/v2/files$</from>
        <to type="forward">/servlets/query/experiments/files/xml</to>
    </rule>
    <rule>
        <from>^/xml/v2/files/([E]-\w{4}-\d+)$</from>
        <set type="parameter" name="accession">$1</set>
        <to type="forward">/servlets/query/experiments/files/xml</to>
    </rule>
    <rule>
        <from>^/xml/v2/files/(.*)$</from>
        <set type="parameter" name="keywords">$1</set>
        <to type="forward">/servlets/query/experiments/files/xml</to>
    </rule>
    <!-- json-flavored rest api -->
    <rule>
        <from>^/json/v2/experiments$</from>
        <set type="parameter" name="flusheaders">1</set>
        <to type="forward">/servlets/query/experiments/experiments/json</to>
    </rule>
    <rule>
        <from>^/json/v2/experiments/([E]-\w{4}-\d+)$</from>
        <set type="parameter" name="accession">$1</set>
        <to type="forward">/servlets/query/experiments/experiments/json</to>
    </rule>
    <rule>
        <from>^/json/v2/experiments/(.*)$</from>
        <set type="parameter" name="flusheaders">1</set>
        <set type="parameter" name="keywords">$1</set>
        <to type="forward">/servlets/query/experiments/experiments/json</to>
    </rule>
    <rule>
        <from>^/json/v2/files$</from>
        <set type="parameter" name="flusheaders">1</set>
        <to type="forward">/servlets/query/experiments/files/json</to>
    </rule>
    <rule>
        <from>^/json/v2/files/([E]-\w{4}-\d+)$</from>
        <set type="parameter" name="accession">$1</set>
        <to type="forward">/servlets/query/experiments/files/json</to>
    </rule>
    <rule>
        <from>^/json/v2/files/(.*)$</from>
        <set type="parameter" name="flusheaders">1</set>
        <set type="parameter" name="keywords">$1</set>
        <to type="forward">/servlets/query/experiments/files/json</to>
    </rule>

    <!-- proxy calls to json efo api for nils -->
    <rule>
        <from>^/json/v2/efotree$</from>
        <to type="forward">/servlets/proxy/http://orange.ebi.ac.uk:8180/microarray-as/ae/json/v2/efotree</to>
    </rule>
    <rule>
        <from>^/json/v2/efodict$</from>
        <to type="forward">/servlets/proxy/http://orange.ebi.ac.uk:8180/microarray-as/ae/json/v2/efodict</to>
    </rule>

    <!-- ebeye export -->
    <rule>
        <from>^/export/AER2EBeye.xml$</from>
        <set type="parameter" name="version">1</set>
        <to type="forward">/servlets/query/experiments/experiments-ebeye/xml</to>
    </rule>
    <rule>
        <from>^/export/ebeye_export.xml$</from>
        <set type="parameter" name="version">2</set>
        <to type="forward">/servlets/query/experiments/experiments-ebeye/xml</to>
    </rule>

    <!-- search results export in tab format -->
    <rule>
        <from>^/ArrayExpress-Experiments\.xls$</from>
        <to type="forward">/servlets/query/experiments/experiments/xls</to>
    </rule>
    <rule>
        <from>^/ArrayExpress-Experiments\.txt$</from>
        <to type="forward">/servlets/query/experiments/experiments/tab</to>
    </rule>

    <!-- print-friendly layout for the experiments -->
    <rule>
        <from>^/browse\.printer\.html$</from>
        <to type="forward">/servlets/query/experiments/browse-experiments-printer/html</to>
    </rule>

    <!-- redirects to some pages at www.ebi.ac.uk (via proxy servlet) -->
    <rule>
        <from>^/ae-news.xml</from>
        <to type="forward">/servlets/proxy/http://www.ebi.ac.uk/microarray-srv/ae/ae-main-news.xml</to>
    </rule>
    <rule>
        <from>^/ae-links.xml</from>
        <to type="forward">/servlets/proxy/http://www.ebi.ac.uk/microarray-srv/ae/ae-main-links.xml</to>
    </rule>
    <rule>
        <from>^/atlas_list-species.html</from>
        <to type="forward">/servlets/proxy/http://www.ebi.ac.uk/gxa/list-species.jsp</to>
    </rule>
    <rule>
        <from>^/atlas_stats.txt</from>
        <to type="forward">/servlets/proxy/http://www.ebi.ac.uk/gxa/stats.jsp</to>
    </rule>
    <rule>
        <from>^/www-inc/(.+)</from>
        <to type="forward">/servlets/proxy/http://www.ebi.ac.uk/inc/$1</to>
    </rule>
    <!-- hiding browse helpers behind innocent names -->
    <rule>
        <from>^/browse-table.html</from>
        <to type="forward">/servlets/query/experiments/browse-experiments/html</to>
    </rule>
    <rule>
        <from>^/browse-table-debug.html</from>
        <to type="forward">/servlets/query/experiments/browse-experiments-debug/html</to>
    </rule>
    <rule>
        <from>^/browse-table-test.html</from>
        <to type="forward">/servlets/query/experiments/browse-experiments-test/html</to>
    </rule>
    <rule>
        <from>^/species-list.html</from>
        <to type="forward">/servlets/lookup/species</to>
    </rule>
    <rule>
        <from>^/arrays-list.html</from>
        <to type="forward">/servlets/lookup/arrays</to>
    </rule>
    <rule>
        <from>^/expdesign-list.html</from>
        <to type="forward">/servlets/lookup/expdesign</to>
    </rule>
    <rule>
        <from>^/exptech-list.html</from>
        <to type="forward">/servlets/lookup/exptech</to>
    </rule>
    <rule>
        <from>^/keywords.txt</from>
        <to type="forward">/servlets/lookup/keywords</to>
    </rule>
    <rule>
        <from>^/efotree.txt</from>
        <to type="forward">/servlets/lookup/efotree</to>
    </rule>
    <rule>
        <from>^/ae-stats.xml</from>
        <to type="forward">/servlets/query/experiments/stats/xml</to>
    </rule>
    <rule>
        <from>^/verify-login.txt</from>
        <to type="forward">/servlets/verify-login</to>
    </rule>

    <!-- control links -->
    <rule>
        <from>^/reload-atlas-info</from>
        <to type="forward">/servlets/control/reload-atlas-info</to>
    </rule>
    <rule>
        <from>^/reload-efo</from>
        <to type="forward">/servlets/control/reload-efo</to>
    </rule>
    <rule>
        <from>^/update-efo</from>
        <to type="forward">/servlets/control/update-efo</to>
    </rule>
    <rule>
        <from>^/reload-atlas-info</from>
        <to type="forward">/servlets/control/reload-atlas-info</to>
    </rule>
    <rule>
        <from>^/reload-ae1-xml</from>
        <to type="forward">/servlets/control/reload-ae1-xml</to>
    </rule>
    <rule>
        <from>^/reload-ae1-xml/(.+)</from>
        <to type="forward">/servlets/control/reload-ae1-xml/$1</to>
    </rule>
    <rule>
        <from>^/reload-ae2-xml</from>
        <to type="forward">/servlets/control/reload-ae2-xml</to>
    </rule>
    <rule>
        <from>^/rescan-ftp</from>
        <to type="forward">/servlets/control/rescan-files</to>
    </rule>
    <rule>
        <from>^/rescan-ftp/(.+)</from>
        <to type="forward">/servlets/control/rescan-files/$1</to>
    </rule>
    <rule>
        <from>^/check-ftp</from>
        <to type="forward">/servlets/control/check-files</to>
    </rule>
    <rule>
        <from>^/test-email</from>
        <to type="forward">/servlets/control/test-email</to>
    </rule>

    <!-- experimental noajax browse interface -->
    <rule>
        <from>^/browse-noajax.html$</from>
        <to type="forward">/servlets/query/experiments/browse-experiments-noajax/html?cache=true</to>
    </rule>

    <!-- legacy links -->
    <rule>
        <from>^/query/result$</from>
        <condition type="parameter" name="queryFor" operator="equal">Experiment</condition>
        <condition type="parameter" name="eAccession">.+</condition>
        <to type="permanent-redirect">%{context-path}/experiments/%{parameter:eAccession}</to>
    </rule>
    
    <rule>
        <from>^/query/result$</from>
        <condition type="parameter" name="queryFor" operator="equal">Experiment</condition>
        <to type="permanent-redirect">%{context-path}/browse.html</to>
    </rule>

    <rule>
        <from>^/query/result$</from>
        <condition type="parameter" name="queryFor" operator="equal">PhysicalArrayDesign</condition>
        <condition type="parameter" name="aAccession">.+</condition>
        <to type="permanent-redirect">%{context-path}/arrays/%{parameter:aAccession}</to>
    </rule>

    <rule>
        <from>^/query/result$</from>
        <condition type="parameter" name="queryFor" operator="equal">PhysicalArrayDesign</condition>
        <to type="permanent-redirect">%{context-path}/arrays/browse.html</to>
    </rule>

    <rule>
        <from>^/query/(.+)$</from>
        <to type="permanent-redirect">%{context-path}/upgraded.html</to>
    </rule>

    <rule>
        <from>^/query/?$</from>
        <to type="permanent-redirect">%{context-path}</to>
    </rule>

    <rule>
        <from>^/genes/uniprot/(.*)$</from>
        <to type="permanent-redirect">${interface.application.link.atlas.base.url}/gene?gid=$1</to>
    </rule>
    <rule>
        <from>^/genes/ensembl/(.*)$</from>
        <to type="permanent-redirect">${interface.application.link.atlas.base.url}/gene?gid=$1</to>
    </rule>
    <rule>
        <from>^/genes/any/(.*)$</from>
        <to type="permanent-redirect">${interface.application.link.atlas.base.url}/gene?gid=$1</to>
    </rule>
    <!-- ArrayExpress old link redirects  -->
    <rule>
        <from>^/news_archive.html$</from>
        <to type="permanent-redirect">http://www.ebi.ac.uk/fg/general/news.html</to>
    </rule>

    <rule>
        <from>^/Help/faq.html$</from>
        <to type="permanent-redirect">http://www.ebi.ac.uk/fg/doc/help/faq.html</to>
    </rule>

    <rule>
        <from>^/Help/stats/?$</from>
        <to type="permanent-redirect">http://www.ebi.ac.uk/fg/doc/stats/index.html</to>
    </rule>

    <rule>
        <from>^/Help/index.html$</from>
        <to type="permanent-redirect">http://www.ebi.ac.uk/fg/doc/help/ae_help.html</to>
    </rule>

    <rule>
        <from>^/Help/?$</from>
        <to type="permanent-redirect">http://www.ebi.ac.uk/fg/doc/help/ae_help.html</to>
    </rule>

    <rule>
        <from>^/Implementation/?$</from>
        <to type="permanent-redirect">http://www.ebi.ac.uk/fg/doc/software/ae_index.html</to>
    </rule>

    <rule>
        <from>^/Schema/?$</from>
        <to type="permanent-redirect">http://www.ebi.ac.uk/fg/doc/software/ae_index.html</to>
    </rule>

    <rule>
        <from>^/Standards/?$</from>
        <to type="permanent-redirect">http://www.ebi.ac.uk/fg/doc/standards.html</to>
    </rule>

    <rule>
        <from>^/Submissions/?$</from>
        <to type="permanent-redirect">http://www.ebi.ac.uk/fg/submissions_overview.html</to>
    </rule>

    <!-- hack for Ibrahim's tool -->
    <rule>
        <from>^/AEVisualCurate/main.jsp</from>
        <to type="forward">/servlets/proxy/http://rachmaninoff.windows.ebi.ac.uk:8080/AEvisualCurate/main.jsp</to>
    </rule>

    <rule>
        <from>^/AEVisualCurate/getPlotJSON.jsp</from>
        <to type="forward">/servlets/proxy/http://rachmaninoff.windows.ebi.ac.uk:8080/AEvisualCurate/getPlotJSON.jsp</to>
    </rule>

    <rule>
        <from>^/AEVisualCurate/plots.jsp</from>
        <to type="forward">/servlets/proxy/http://rachmaninoff.windows.ebi.ac.uk:8080/AEvisualCurate/plots.jsp</to>
    </rule>

    <rule>
        <from>^/AEVisualCurate/updateXML.jsp</from>
        <to type="forward">/servlets/proxy/http://rachmaninoff.windows.ebi.ac.uk:8080/AEvisualCurate/updateXML.jsp</to>
    </rule>
</urlrewrite>
