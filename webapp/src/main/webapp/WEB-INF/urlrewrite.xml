<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE urlrewrite
        PUBLIC "-//tuckey.org//DTD UrlRewrite 4.0//EN"
        "http://www.tuckey.org/res/dtds/urlrewrite4.0.dtd">

<urlrewrite>
    <!-- global rule to set original request uri as a parameter -->
    <rule>
        <from>.*</from>
        <set type="parameter" name="original-request-uri">%{request-uri}</set>
    </rule>

    <!-- skip all requests for assets -->
    <rule>
        <from>^(/assets/.*)$</from>
        <to last="true">$1</to>
    </rule>

    <!-- home page -->
    <rule>
        <from>^/index[.]html?$</from>
        <to type="redirect" last="true">%{context-path}/</to>
    </rule>

    <rule>
        <from>^/$</from>
        <to type="forward" last="true">/servlets/query/-/home/html</to>
    </rule>

    <!-- search page -->
    <rule>
        <condition type="query-string" operator="greater"/>
        <from>^/search/?$</from>
        <to type="redirect" last="true">%{context-path}/studies/search.html?%{query-string}</to>
    </rule>
    <rule>
        <from>^/search/?$</from>
        <to type="redirect" last="true">%{context-path}/studies/</to>
    </rule>

    <!-- studies browser/search -->
    <rule>
        <condition type="query-string" operator="greater"/>
        <from>^/studies/?$</from>
        <to type="redirect" last="true">%{context-path}/studies/search.html?%{query-string}</to>
    </rule>
    <rule>
        <from>^/studies$</from>
        <to type="redirect" last="true">%{context-path}/studies/</to>
    </rule>
    <rule>
        <from>^/studies/index[.]html?$</from>
        <to type="redirect" last="true">%{context-path}/studies/</to>
    </rule>
    <rule>
        <from>^/studies/$</from>
        <to type="forward" last="true">/servlets/query/studies/browse/html</to>
    </rule>
    <rule>
        <from>^/studies/search[.]html?$</from>
        <to type="forward" last="true">/servlets/query/studies/browse/html</to>
    </rule>

    <!-- study view -->
    <rule>
        <from>^/studies/([^/]+)/?$</from>
        <set type="parameter" name="accession">$1</set>
        <to type="forward" last="true">/servlets/query/studies/detail/html</to>
    </rule>

    <!-- study files -->
    <!--
    <rule>
        <from>^/studies/([^/]+)/files/$</from>
        <set type="parameter" name="accession">$1</set>
        <to type="forward" last="true">/servlets/query/files/browse/html</to>
    </rule>
    <rule>
        <from>^/studies/([^/]+)/files$</from>
        <to type="redirect" last="true">%{context-path}/studies/$1/files/</to>
    </rule>
    <rule>
        <from>^/studies/([^/]+)/files[.]html?$</from>
        <to type="permanent-redirect" last="true">%{context-path}/studies/$1/files/</to>
    </rule>
    <rule>
        <from>^/studies/([^/]+)/files/index[.]html?$</from>
        <to type="permanent-redirect" last="true">%{context-path}/studies/$1/files/</to>
    </rule>
    <rule>
        <from>^/studies/([^/]+)/files/([^/.]+)/$</from>
        <set type="parameter" name="accession">$1</set>
        <set type="parameter" name="kind">$2</set>
        <to type="forward" last="true">/servlets/query/files/browse/html</to>
    </rule>
    <rule>
        <from>^/studies/([^/]+)/files/([^/.]+)$</from>
        <to type="redirect" last="true">%{context-path}/experiments/$1/files/$2/</to>
    </rule>
    <rule>
        <from>^/studies/([^/]+)/files/([^/.]+)/index[.]html?$</from>
        <to type="permanent-redirect" last="true">%{context-path}/studies/$1/files/$2/</to>
    </rule>
    -->
    <rule>
        <from>^/files/([^/]+)/([^/]+)$</from>
        <to type="forward" last="true">/servlets/download/${upper:$1}/$2</to>
    </rule>
    <!-- about page -->
    <rule>
        <from>^/about[.]html?$</from>
        <set type="parameter" name="filename">about.html</set>
        <to type="forward" last="true">/servlets/query/-/static-page/html</to>
    </rule>
    <rule>
        <from>^/acknowledgements[.]html?$</from>
        <to type="redirect" last="true">%{context-path}/about.html#acknowledgements</to>
    </rule>
    <!-- submit pages -->
    <rule>
        <from>^/submit$</from>
        <to type="redirect" last="true">%{context-path}/submit/</to>
    </rule>
    <rule>
        <from>^/submit/.*$</from>
        <set type="parameter" name="filename">submit.html</set>
        <to type="forward" last="true">/servlets/query/-/static-page/html</to>
    </rule>
    <!-- help pages -->
    <rule>
        <from>^/help$</from>
        <to type="redirect" last="true">%{context-path}/help/</to>
    </rule>
    <rule>
        <from>^/help/$</from>
        <set type="parameter" name="filename">help/index.html</set>
        <to type="forward" last="true">/servlets/query/-/static-page/html</to>
    </rule>
    <rule>
        <from>^/help/(.+)[.]html?$</from>
        <set type="parameter" name="filename">help/${lower:$1}.html</set>
        <to type="forward" last="true">/servlets/query/-/static-page/html</to>
    </rule>

    <!-- global search dump export -->
    <rule>
        <from>^/export/ebeye_export[.]xml$</from>
        <set type="parameter" name="version">2</set>
        <to type="forward" last="true">/servlets/query/experiments/ebeye/xml</to>
    </rule>

    <!-- proxy calls to json efo api for nils -->
    <rule>
        <from>^/json/v2/efotree$</from>
        <to type="forward" last="true">/servlets/proxy/http://orange.ebi.ac.uk:8180/microarray-as/ae/json/v2/efotree</to>
    </rule>
    <rule>
        <from>^/json/v2/efodict$</from>
        <to type="forward" last="true">/servlets/proxy/http://orange.ebi.ac.uk:8180/microarray-as/ae/json/v2/efodict</to>
    </rule>
    <rule>
        <from>^/keywords[.]txt</from>
        <to type="forward" last="true">/servlets/lookup/keywords</to>
    </rule>
    <rule>
        <from>^/efowords[.]txt</from>
        <to type="forward" last="true">/servlets/lookup/efowords</to>
    </rule>
    <rule>
        <from>^/efotree[.]txt</from>
        <to type="forward" last="true">/servlets/lookup/efotree</to>
    </rule>

    <!-- control links -->
    <rule>
        <from>^/reload-efo$</from>
        <to type="forward" last="true">/servlets/control/reload-efo</to>
    </rule>
    <rule>
        <from>^/update-efo$</from>
        <to type="forward" last="true">/servlets/control/update-efo</to>
    </rule>
    <rule>
        <from>^/delete/([^/]+)/?$</from>
        <set type="parameter" name="accession">$1</set>
        <to type="forward" last="true">/servlets/control/delete</to>
    </rule>
    <rule>
        <from>^/reload-xml/([^/]+)/?$</from>
        <set type="parameter" name="xmlFilePath">$1</set>
        <to type="forward" last="true">/servlets/control/reload-xml</to>
    </rule>
    <rule>
        <from>^/reload-xml/?$</from>
        <to type="forward" last="true">/servlets/control/reload-xml</to>
    </rule>
    <rule>
        <from>^/clear-index$</from>
        <to type="forward" last="true">/servlets/control/clear-index</to>
    </rule>
    <rule>
        <from>^/rescan-files$</from>
        <to type="forward" last="true">/servlets/control/rescan-files</to>
    </rule>
    <rule>
        <from>^/consistency-check$</from>
        <to type="forward" last="true">/servlets/control/check-experiments</to>
    </rule>
    <rule>
        <from>^/check-files$</from>
        <to type="forward" last="true">/servlets/control/check-files</to>
    </rule>
    <rule>
        <from>^/test-email$</from>
        <to type="forward" last="true">/servlets/control/test-email</to>
    </rule>
    <rule>
        <from>^/restart-app$</from>
        <to type="forward" last="true">/servlets/control/restart</to>
    </rule>

    <!-- test page -->
    <rule>
        <from>^/test[.]html?$</from>
        <to type="forward" last="true">/servlets/query/-/test/html</to>
    </rule>
</urlrewrite>
