<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <app>
        <reports>
            <originator>"ArrayExpress Archive" &lt;arrayexpress@ebi.ac.uk&gt;</originator>
            <recipients>kolais@ebi.ac.uk</recipients>
            <smtp><server>smtp.ebi.ac.uk</server></smtp>
        </reports>
    </app>
    <ae>
        <db>
            <connections>
                <connection>
                    <name>local</name>
                    <driver>oracle.jdbc.OracleDriver</driver>
                    <url>jdbc:oracle:thin:@localhost:1521:AEPUB1</url>
                    <username>${interface.application.db.username}</username>
                    <password>${interface.application.db.password}</password>
                    <minConnections>30</minConnections>
                    <maxConnections>30</maxConnections>
                    <testStatement>select 1 from tt_security where rownum = 1</testStatement>
                </connection>
                <connection>
                    <name>aepub1</name>
                    <driver>oracle.jdbc.OracleDriver</driver>
                    <url>jdbc:oracle:thin:@otto.ebi.ac.uk:1521:AEPUB1</url>
                    <username>${interface.application.db.username}</username>
                    <password>${interface.application.db.password}</password>
                    <minConnections>30</minConnections>
                    <maxConnections>30</maxConnections>
                    <testStatement>select 1 from tt_security where rownum = 1</testStatement>
                </connection>
                <connection>
                    <name>aepub2</name>
                    <driver>oracle.jdbc.OracleDriver</driver>
                    <url>jdbc:oracle:thin:@moe.ebi.ac.uk:1521:AEPUB2</url>
                    <username>${interface.application.db.username}</username>
                    <password>${interface.application.db.password}</password>
                    <minConnections>30</minConnections>
                    <maxConnections>30</maxConnections>
                    <testStatement>select 1 from tt_security where rownum = 1</testStatement>
                </connection>
                <connection>
                    <name>aepub3</name>
                    <driver>oracle.jdbc.OracleDriver</driver>
                    <url>jdbc:oracle:thin:@smithers.ebi.ac.uk:1521:AEPUB3</url>
                    <username>${interface.application.db.username}</username>
                    <password>${interface.application.db.password}</password>
                    <minConnections>30</minConnections>
                    <maxConnections>30</maxConnections>
                    <testStatement>select 1 from tt_security where rownum = 1</testStatement>
                </connection>
                <connection>
                    <name>aecur</name>
                    <driver>oracle.jdbc.OracleDriver</driver>
                    <url>jdbc:oracle:thin:@moe.ebi.ac.uk:1521:AECUR</url>
                    <username>${interface.application.db.username}</username>
                    <password>${interface.application.db.password}</password>
                    <minConnections>30</minConnections>
                    <maxConnections>30</maxConnections>
                    <testStatement>select 1 from tt_security where rownum = 1</testStatement>
                </connection>
            </connections>
        </db>
        <experiments>
            <ae1>
                <source-location>${interface.application.pref.experiments.ae1.source.location}</source-location>
                <db-connections>${interface.application.pref.experiments.ae1.connections}</db-connections>
                <reload>
                    <atstart>false</atstart>
                    <schedule>${interface.application.pref.experiments.ae1.reload.schedule}</schedule>
                    <threads>25</threads>
                </reload>
                <export-location>${interface.application.pref.experiments.ae1.export.location}</export-location>
            </ae1>
            <ae2>
                <source-location>${interface.application.pref.experiments.ae2.source.location}</source-location>
                <reload>
                    <atstart>false</atstart>
                    <schedule>${interface.application.pref.experiments.ae2.reload.schedule}</schedule>
                </reload>
            </ae2>

            <persistence-location>${sys:java.io.tmpdir}/${interface.application.pref.files.prefix}-experiments.xml</persistence-location>
        </experiments>
        <atlasexperiments>
            <source><location>http://www.ebi.ac.uk/gxa/api?experiment=listAll&amp;experimentInfoOnly=yes&amp;format=xml</location></source>
            <persistence-location>${sys:java.io.tmpdir}/${interface.application.pref.files.prefix}-atlas-experiments.txt</persistence-location>
            <reload>
                <atstart>false</atstart>
                <schedule>${interface.application.pref.experiments.reload.schedule}</schedule>
            </reload>
        </atlasexperiments>
        <arrays>
            <persistence-location>${sys:java.io.tmpdir}/${interface.application.pref.files.prefix}-arrays.xml</persistence-location>
            <dropdown-html-location>${sys:java.io.tmpdir}/${interface.application.pref.files.prefix}-arrays-dropdown-html.txt</dropdown-html-location>
        </arrays>
        <users>
            <persistence-location>${sys:java.io.tmpdir}/${interface.application.pref.files.prefix}-users.xml</persistence-location>
        </users>
        <events>
            <persistence-location>${sys:java.io.tmpdir}/${interface.application.pref.files.prefix}-events.xml</persistence-location>
        </events>

        <files>
            <root><location>${interface.application.pref.files.root.location}</location></root>
            <persistence-location>${sys:java.io.tmpdir}/${interface.application.pref.files.prefix}-files.xml</persistence-location>
            <rescan><interval>${interface.application.pref.files.rescan.interval}</interval></rescan>
        </files>
        <species>
            <dropdown-html-location>${sys:java.io.tmpdir}/${interface.application.pref.files.prefix}-species-dropdown-html.txt</dropdown-html-location>
        </species>
        <efo>
            <source>/WEB-INF/classes/efo.owl</source>
            <synonyms>/WEB-INF/classes/synonyms.txt</synonyms>
            <stopWords>a,able,about,across,after,all,almost,also,am,among,an,and,any,are,as,at,be,because,been,but,by,can,cannot,could,dear,did,do,does,either,else,ever,every,for,from,get,got,had,has,have,he,her,hers,him,his,how,however,i,if,in,into,is,it,its,just,least,let,like,likely,may,me,might,most,must,my,neither,no,nor,not,of,off,often,on,only,or,other,our,own,rather,said,say,says,she,should,since,so,some,than,that,the,their,them,then,there,these,they,this,tis,to,too,twas,us,wants,was,we,were,what,when,where,which,while,who,whom,why,will,with,would,yet,you,your</stopWords>
            <index><location>${sys:java.io.tmpdir}/${interface.application.pref.files.prefix}-index/efo</location></index>
        </efo>
        <index id="experiments" location="${sys:java.io.tmpdir}/${interface.application.pref.files.prefix}-index" defaultAnalyzer="uk.ac.ebi.arrayexpress.utils.search.AttributeFieldAnalyzer">
            <document path="/experiments/experiment" defaultField="keywords">
                <field name="keywords" type="string" path="string-join(.//text(), ' ')" analyze="true" analyzer="uk.ac.ebi.arrayexpress.utils.search.ExperimentTextAnalyzer" store="false" escape="false"/>
                <field name="accession" title="by Accession" type="string" path="accession | secondaryaccession" analyze="true" store="false" escape="false"/>
                <field name="date" title="by Release Date" type="string" path="releasedate" analyze="true" store="false" escape="false"/>
                <field name="species" title="by Species" type="string" path="species" analyze="true" store="false" escape="false"/>
                <field name="array" title="by Array" type="string" path="arraydesign/id | arraydesign/accession | arraydesign/name" analyze="true" store="false" escape="false"/>
                <field name="exptype" title="by Experiment Type" type="string" path="experimenttype" analyze="true" store="false" escape="false"/>
                <field name="expdesign" title="by Experiment Design" type="string" path="experimentdesign" analyze="true" store="false" escape="false"/>
                <field name="ef" title="by Experimental Factor" type="string" path="experimentalfactor/name" analyze="true" store="false" escape="false"/>
                <field name="efv" title="by Experimental Factor Value" type="string" path="experimentalfactor/value" analyze="true" store="false" escape="false"/>
                <field name="sa" title="by Sample Attribute Value" type="string" path="sampleattribute/value" analyze="true" store="false" escape="true"/>
                <field name="pmid" title="by PubMed ID" type="string" path="bibliography/accession" analyze="false" store="false" escape="false"/>
                <field name="userid" type="string" path="user/@id" analyze="false" store="false" escape="false"/>
                <!-- boolean fields -->
                <field name="gxa" title="only experiments loaded in Gene Expression Atlas" type="boolean" path="@loadedinatlas = 'true'"/>
                <field name="directsub" title="only ArrayExpress direct submissions" type="boolean" path="not(contains(accession, '-GEOD-'))"/>
                <!-- multiple-source filters for curators -->
                <field name="source" type="string" path="source/@id" analyze="false" store="false" escape="false"/>
                <field name="public" type="boolean" path="user/@id = '1'"/>
                <field name="migrated" type="boolean" path="source/@migrated = 'true'"/>
                <field name="identical" type="boolean" path="source/@identical = 'true'"/>
                <field name="visible" type="boolean" path="source/@visible = 'true'"/>
                <!-- numeric fields -->
                <field name="assaycount" title="Number of Assays" type="integer" path="(if (assays castable as xs:integer) then assays else 0) cast as xs:integer" />
                <field name="samplecount" title="Number of Samples" type="integer" path="(if (samples castable as xs:integer) then samples else 0) cast as xs:integer" />
                <field name="rawcount" type="integer" path="(if (rawdatafiles castable as xs:integer) then rawdatafiles else 0) cast as xs:integer" />
                <field name="fgemcount" type="integer" path="(if (fgemdatafiles castable as xs:integer) then fgemdatafiles else 0) cast as xs:integer" />
                <field name="efcount"  title="Number of Experimental Factors" type="integer" path="count(distinct-values(experimentalfactor/name, 'http://saxon.sf.net/collation?ignore-case=yes'))" />
                <field name="sacount" title="Number of Sample Attributes" type="integer" path="count(distinct-values(sampleattribute/category, 'http://saxon.sf.net/collation?ignore-case=yes'))" />
                <field name="miamescore" title="MIAME Score" type="integer" path="(if (miamescores/overallscore castable as xs:integer) then miamescores/overallscore else 0) cast as xs:integer" />
                <field name="minseqescore" title="MINSEQE Score" type="integer" path="(if (minseqescores/overallscore castable as xs:integer) then minseqescores/overallscore else 0) cast as xs:integer" />
            </document>
        </index>
        <index id="arrays" location="${sys:java.io.tmpdir}/${interface.application.pref.files.prefix}-index" defaultAnalyzer="uk.ac.ebi.arrayexpress.utils.search.AttributeFieldAnalyzer">
            <document path="/array_designs/array_design" defaultField="keywords">
                <field name="keywords" type="string" path="string-join(.//text(), ' ')" analyze="true" analyzer="uk.ac.ebi.arrayexpress.utils.search.ExperimentTextAnalyzer" store="false" escape="false"/>
                <field name="accession" title="by Accession" type="string" path="accession" analyze="true" store="false" escape="false"/>
                <field name="species" title="by Species" type="string" path="species" analyze="true" store="false" escape="false"/>
                <field name="userid" type="string" path="user/@id" analyze="false" store="false" escape="false"/>
                <!-- multiple-source filters for curators -->
                <field name="source" type="string" path="@source" analyze="false" store="false" escape="false"/>
                <field name="public" type="boolean" path="user/@id = '1'"/>
                <field name="migrated" type="boolean" path="@migrated = 'true'"/>
                <field name="visible" type="boolean" path="@visible = 'true'"/>
            </document>
        </index>
        <index id="files" location="${sys:java.io.tmpdir}/${interface.application.pref.files.prefix}-index" defaultAnalyzer="uk.ac.ebi.arrayexpress.utils.search.AttributeFieldAnalyzer">
            <document path="/files/folder" defaultField="accession">
                <field name="accession" title="" type="string" path="@accession" analyze="true" store="false" escape="false"/>
                <field name="filename" title="" type="string" path="file/@name"  analyze="true" store="false" escape="false"/>
            </document>
        </index>
        <index id="users" location="${sys:java.io.tmpdir}/${interface.application.pref.files.prefix}-index" defaultAnalyzer="uk.ac.ebi.arrayexpress.utils.search.AttributeFieldAnalyzer">
            <document path="/users/user" defaultField="keywords">
                <field name="keywords" type="string" path="string-join(.//text(), ' ')" analyze="true" analyzer="uk.ac.ebi.arrayexpress.utils.search.ExperimentTextAnalyzer" store="false" escape="false"/>
                <field name="id" title="" type="string" path="id" analyze="true" store="false" escape="false"/>
                <field name="name" title="" type="string" path="name" analyze="true" store="false" escape="false"/>
                <field name="email" title="" type="string" path="email"  analyze="true" store="false" escape="false"/>
                <field name="admin" title="" type="boolean" path="is_privileged/text() = 'true'"/>
                <!-- multiple-source filters for curators -->
                <field name="source" type="string" path="@source" analyze="false" store="false" escape="false"/>
                <field name="migrated" type="boolean" path="@migrated = 'true'"/>
            </document>
        </index>
        <index id="events" location="${sys:java.io.tmpdir}/${interface.application.pref.files.prefix}-index" defaultAnalyzer="uk.ac.ebi.arrayexpress.utils.search.AttributeFieldAnalyzer">
            <document path="/events/event" defaultField="category">
                <field name="category" title="" type="string" path="category" analyze="true" store="false" escape="false"/>
                <field name="success" title="" type="boolean" path="successful/text() = 'true'"/>
            </document>
        </index>
    </ae>
</configuration>
